#include "defines.h"
#include "mapa.h"
#include "i386.h"


ca (*screen)[ROW_SIZE] = (ca (*)[ROW_SIZE])VIDEO;


const char mapa_original[40][80] = {
	"....PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP....",
	"....PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP....",
	"....PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP....",
	"....PPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPP....",
	"................................................................................",
	"....LLLLLLLLLLLLLL.....LLLLLLLLLLLLLLL.....LLLLLLLLLLLLLL........LLLLLLLL.......",
	"....LLLLLLLLLLLLLL.....LLLLLLLLLLLLLLL.....LLLLLLLLLLLLLL.......LLLLLLLLLL......",
	"....LLLLLLLLLLLLLL.....LLLLLLLLLLLLLLL.....LLLLLLLLLLLLLL......LLLLLLLLLLLL.....",
	"....LLL........LLL.....LLL.........LLL.....LLL........LLL.....LLLL......LLLL....",
	"....LLL........LLL.....LLL.........LLL.....LLL................LLL........LLL....",
	"....LLL........LLL.....LLL.........LLL.....LLL................LLL........LLL....",
	"....LLL........LLL.....LLLLLLLLLLLLLLL.....LLL.....LLLLLL.....LLL........LLL....",
	"....LLL........LLL.....LLLLLLLLLLLLLLL.....LLL.....LLLLLL.....LLLLLLLLLLLLLL....",
	"....LLL........LLL.....LLLLLLLLLLLLLLL.....LLL.....LLLLLL.....LLLLLLLLLLLLLL....",
	"....LLL........LLL.....LLL.....LLLL........LLL........LLL.....LLLLLLLLLLLLLL....",
	"....LLLLLLLLLLLLLL.....LLL......LLLL.......LLLLLLLLLLLLLL.....LLL........LLL....",
	"....LLLLLLLLLLLLLL.....LLL.......LLLL......LLLLLLLLLLLLLL.....LLL........LLL....",
	"....LLLLLLLLLLLLLL.....LLL........LLLL.....LLLLLLLLLLLLLL.....LLL........LLL....",
	"........LL......................................................................",
	".........LL.....................................................................",
	"..........LL....................................................................",
	"...........LL...............................................PPP...PPP...........",
	"............LL.................LLLLLLLLLLLLLL..............PPPPP.PPPPP..........",
	".............PP...............LLLLLLLLLLLLLLLL............PPPPPPPPPPPPP.........",
	"............PPPP.............LLLLLL.....LLLLLLL............PPPPPPPPPPP..........",
	"...........PPPPPP............LLLL.........LLLLL.............PPPPPPPPP...........",
	"..........PPPPPPPP.......................LLLLLL..............PPPPPPP............",
	"..........PPPPPPPP.....................LLLLLLL................PPPPP.............",
	"...........PPPPPP....................LLLLLLL...................PPP..............",
	"............PPPP...................LLLLLLL......................P...............",
	".............PP..................LLLLLLL........................................",
	"..............LL...............LLLLLLL..........................................",
	"...............LL............LLLLLLLLLLLLLLLLLLL................................",
	"................LL...........LLLLLLLLLLLLLLLLLLL................................",
	".................LL..........LLLLLLLLLLLLLLLLLLL................................",
	"..................LL............................................................",
	"....PPPPPPPPPPPPPPLLPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPLLPPPPPPPPPPPPPPPP....",
	"....PPPPPPPPPPPPPPLLPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPLLPPPPPPPPPPPPPPPP....",
	"....PPPPPPPPPPPPPPLLPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPLLPPPPPPPPPPPPPPPP....",
	"....PPPPPPPPPPPPPPLLPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPPLLPPPPPPPPPPPPPPPP....",
};

char mapa_mod[40][80];

char buffer_debugger[40][80];

const char AMALIN_WINS[40][80] = {
	"................................................................................",
	"................................................................................",
	"................................................................................",
	"................................................................................",
	"................................................................................",
	"........####.....##......##.....####.....###.........##########..##......##.....",
	".......######....###....###....######....###.........##########..###.....##.....",
	"......########...####..####...########...###............####.....####....##.....",
	".....####..####..##########..####..####..###............####.....#####...##.....",
	".....###....###..##.####.##..###....###..###............####.....##.###..##.....",
	".....###....###..##..##..##..###....###..###............####.....##..###.##.....",
	".....###....###..##......##..###....###..###............####.....##...#####.....",
	".....##########..##......##..##########..###............####.....##....####.....",
	".....##########..##......##..##########..###............####.....##.....###.....",
	".....###....###..##......##..###....###..###............####.....##......##.....",
	".....###....###..##......##..###....###..###............####.....##......##.....",
	".....###....###..##......##..###....###..##########..##########..##......##.....",
	".....###....###..##......##..###....###..##########..##########..##......##.....",
	"................................................................................",
	"................................................................................",
	"................................................................................",
	"................................................................................",
	".................##...................##...###...##......##.....................",
	".................##...................##...###...###.....##.....................",
	"..................##.................##....###...####....##.....................",
	"..................##.................##....###...#####...##.....................",
	"...................##...............##.....###...##.###..##.....................",
	"...................##...............##.....###...##..###.##.....................",
	"....................##.............##......###...##...#####.....................",
	"....PPP...PPP.......##......#......##......###...##....####........PPP...PPP....",
	"...PPPPP.PPPPP.......##....###....##.......###...##.....###.......PPPPP.PPPPP...",
	"..PPPPPPPPPPPPP......##..#######..##.......###...##......##......PPPPPPPPPPPPP..",
	"...PPPPPPPPPPP........#####...#####........###...##......##.......PPPPPPPPPPP...",
	"....PPPPPPPPP.........####.....####........###...##......##........PPPPPPPPP....",
	".....PPPPPPP...........##.......##.........###...##......##.........PPPPPPP.....",
	"......PPPPP..........................................................PPPPP......",
	".......PPP............................................................PPP.......",
	"........P..............................................................P........",
	"................................................................................",
	"................................................................................"
};

const char BETAROTE_WINS[40][80] = {
	"................................................................................",
	"................................................................................",
	"................................................................................",
	"................................................................................",
	"................................................................................",
	".######....########..########....####....######.......##.....########..########.",
	".#######...########..########...######...########....####....########..########.",
	".##...###..###..........##.....########..##...###...######......##.....###......",
	".##...###..###..........##.....###..###..##....##..###..###.....##.....###......",
	".##...###..###..........##.....##....##..##....##..##....##.....##.....###......",
	".########..########.....##.....##....##..##...###..##....##.....##.....########.",
	".#######...########.....##.....##....##..#######...##....##.....##.....########.",
	".#######...########.....##.....########..#######...##....##.....##.....########.",
	".##...###..###..........##.....########..##...###..##....##.....##.....###......",
	".##...###..###..........##.....##....##..##....##..###..###.....##.....###......",
	".##...###..###..........##.....##....##..##....##...######......##.....###......",
	".#######...########.....##.....##....##..##....##....####.......##.....########.",
	".######....########.....##.....##....##..##....##.....##........##.....########.",
	"................................................................................",
	"................................................................................",
	"................................................................................",
	"................................................................................",
	".................##...................##...###...##......##.....................",
	".................##...................##...###...###.....##.....................",
	"..................##.................##....###...####....##.....................",
	"..................##.................##....###...#####...##.....................",
	"...................##...............##.....###...##.###..##.....................",
	"...................##...............##.....###...##..###.##.....................",
	"....................##.............##......###...##...#####.....................",
	"....PPP...PPP.......##......#......##......###...##....####........PPP...PPP....",
	"...PPPPP.PPPPP.......##....###....##.......###...##.....###.......PPPPP.PPPPP...",
	"..PPPPPPPPPPPPP......##..#######..##.......###...##......##......PPPPPPPPPPPPP..",
	"...PPPPPPPPPPP........#####...#####........###...##......##.......PPPPPPPPPPP...",
	"....PPPPPPPPP.........####.....####........###...##......##........PPPPPPPPP....",
	".....PPPPPPP...........##.......##.........###...##......##.........PPPPPPP.....",
	"......PPPPP..........................................................PPPPP......",
	".......PPP............................................................PPP.......",
	"........P..............................................................P........",
	"................................................................................",
	"................................................................................"
};

void load_map(void){
	screen[0][0].c = *"X";
	screen[0][0].a = 0x10;
	for(int j = 0; j < COL_SIZE; j++){
		for(int i = 0; i < ROW_SIZE; i++){
			char aux_char = mapa_original[j][i];
			screen[j][i].c = aux_char;
			mapa_mod[j][i] = aux_char;
			if(aux_char != *"."){
				if(aux_char == *"P"){
					screen[j][i].a = 0x44;
				}else{screen[j][i].a = 0x11;}
			}else{screen[j][i].a = 0x22;}
		}
	}
}

void save_map(void){
	for(int j = 0; j < COL_SIZE; j++){
		for(int i = 0; i < ROW_SIZE; i++){
			buffer_debugger[j][i] = screen[j][i].c;
		}
	}
}

void restor_map(void){
	for(int j = 0; j < COL_SIZE; j++){
		for(int i = 0; i < ROW_SIZE; i++){
			char aux_char = buffer_debugger[j][i];
			screen[j][i].c = buffer_debugger[j][i];
			if(aux_char == *"A" || aux_char == *"B"){
				if(aux_char == *"A"){
					screen[j][i].a = 0x24;
				}else{
					screen[j][i].a = 0x21;
				}
			}else{
				if(aux_char != *"."){
					if(aux_char == *"P"){
						screen[j][i].a = 0x44;
					}else{screen[j][i].a = 0x11;}
				}else{screen[j][i].a = 0x22;}
			}
		}
	}
}


char get_simbol(pos_t *pos){
	return screen[pos->x][pos->y].c;
}

void set_simbol(pos_t *pos, ca celda){
	screen[pos->x][pos->y].c = celda.c;
	screen[pos->x][pos->y].a = celda.a;
}

ca get_celda(pos_t *pos){
	ca res;
	res.c = mapa_mod[pos->x][pos->y];
	if(res.c != *"."){
		if(res.c == *"P"){
			res.a = 0x44;
		}else{
			if(res.c == *"L"){
				res.a = 0x11;
			}else{
				if(res.c == *"x"){
					res.a = 0x42;
				}else{
					res.a = 0x12;
				}
			}
		}
	}else{res.a = 0x22;}
	return res;
}

void break_wall(pos_t *pos){
	screen[pos->x][pos->y].c = *"x";
	screen[pos->x][pos->y].a = 0x42;
	mapa_mod[pos->x][pos->y] = *"x";
}

void make_bridge(pos_t *pos){
	screen[pos->x][pos->y].c = *"+";
	screen[pos->x][pos->y].a = 0x12;	
	mapa_mod[pos->x][pos->y] = *"+";
}

void print_A_wins(void){
	for(int j = 0; j < COL_SIZE; j++){
		for(int i = 0; i < ROW_SIZE; i++){
			char aux_char = AMALIN_WINS[j][i];
			if(aux_char != *"."){
					screen[j][i].a = 0x44;
			}else{screen[j][i].a = 0xFF;}
		}
	}
}	

void print_B_wins(void){
	for(int j = 0; j < COL_SIZE; j++){
		for(int i = 0; i < ROW_SIZE; i++){
			char aux_char = BETAROTE_WINS[j][i];
			if(aux_char != *"."){
				screen[j][i].a = 0x11;
			}else{screen[j][i].a = 0xFF;}
		}
	}
}